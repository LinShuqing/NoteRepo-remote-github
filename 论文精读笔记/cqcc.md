# Constant Q Cepstral Coefficients: A Spoofing Countermeasure for Automatic Speaker Verification 笔记

1. 提出了一种将恒Q变换语音信号分析和传统倒谱相结合的方法
2. 报告了在三个不同的数据库中使用 CQC 的情况，表明在每种情况下都处于最好的性能
3. CQCC 的优点来自于可变的谱时间分辨率，能够捕获伪影信号


## Introduction
1. ASVspoof 2015挑战和BTAS 2016演讲者反欺骗比赛的提交报告中强调了一个假设，即欺骗对策的性能目前更依赖于特定特征而不是特定分类器。
2. 本文的研究假设：利用不同于典型ASV系统的特征表示的欺骗对抗系统的设计，除了对不可预见的欺骗攻击有更大的通用性外，还可以对欺骗提供更大的鲁棒性。
3. 本文最重要的贡献是研究了一种全新的ASV欺骗对抗特征提取方法，更广泛地关注语音合成、语音转换和回放欺骗攻击。
4. 该方法基于CQT，最初在音乐领域提出，相比于傅里叶变换，其频率间隔呈几何变化，但是在整个频谱内Q因子恒定。
5. 和 傅里叶变换（在低频率下缺乏频率分辨率，在高频率下缺乏时间分辨率）相比，CQT 变换在低频率时具有较高的频率分辨率，而在高频率时具有更高的时间分辨率。
6. 本文研究 CQT 变换与传统倒谱分析相结合的用于欺骗检测的方法，即CQCC。
7. 在 ASVspoof 2015 数据集中，相较于之前最优结果提升72%，本文在三个标准数据集中进行了更为广泛的评估，并提出了一种新的方法来提供更为普遍的对策。


##  数据库和先前的工作（略）

## 从傅里叶变换到CQT

### 时频表示

不确定性原则表明，不能同时精确测量时间和频率：
$$\Delta f \Delta t \geq 1 / 4 \pi$$
	上式表明，如果一个信号在在频率上分散，则其时间表示被压缩，反之亦然。时间和频率分辨率不能同时降低。这意味着同一时域信号可以由无数不同的时频表示形式指定。其中，短时傅里叶变换（STFT）最受欢迎。

### STFT
STFT 对一段信号做傅里叶变换，通过滑动窗口实现整个样本的信号处理。

STFT 实际上是一个带通滤波器组，Q 系数定义为，滤波器的中心频率和滤波器带宽之比：
$$Q=\frac{f_k}{\delta f}$$
在STFT 中，每个滤波器的带宽是恒定的，当频率从低频到高频时，Q 因子增加。

但是人类的感知系统的 Q 系数在 500Hz-20KHz 之间近似常数，因此，至少从感知角度来看，STFT对于语音信号的时频分析可能并不理想。

### 恒Q变换（CQT）
恒Q变换在过去几年被开发出来，第一种算法由Youngberg和Boll于1978年提出的（Youngberg-Boll，1978年），而另一种算法则是由 Kashima 和MontReynaud-Kashima提出的（Mont Reynaud，1986年）。在这些方法中，倍频程是几何分布的，而每个滤波器的中心频率是线性间隔的。
![[Pasted image 20221011151709.png]]FFT 和 CQT 对比如上图所示。从感知角度来看，几何间隔频率意味着每对相邻滤波器的中心频率具有相同的频率比。

### CQT 计算
离散时域信号 $x(n)$ 的 CQT 计算如下：
$$X^{C Q}(k, n)=\sum_{j=n-\left\lfloor N_k / 2\right\rfloor}^{n+\left\lfloor N_k / 2\right\rfloor} x(j) a_k^*\left(j-n+N_k / 2\right)$$
其中，$k = 1,2,\cdots, K$ 为频率索引，$a_k^*(n)$ 为 $a_k(n)$ 的复共轭，$N_k$ 为可变的窗口大小，$\left\lfloor \cdot \right\rfloor$ 代表向下取整，基函数 $a_k(n)$ 定义如下：
$$a_k(n)=\frac{1}{C}\left(\frac{n}{N_k}\right) \exp \left[i\left(2 \pi n \frac{f_k}{f_s}+\Phi_k\right)\right]$$
其中，$f_k$ 是第 $k$ 个频带的中心频率，$f_s$ 为采样率，$w(t)$ 为窗函数，$\Phi_k$ 为相位偏置，缩放因子 $C$ 由下式给出：
$$C=\sum_{l=-\left\lfloor N_k / 2\right\rfloor}^{\left\lfloor N_k / 2\right\rfloor} w\left(\frac{l+N_k / 2}{N_k}\right)$$
为了满足恒Q变换，中心频率必须满足：
$$f_k=f_1 2^{\frac{k-1}{B}}$$
其中，$f_1$ 是最低频率带的中心频率，$B$ 确定每个倍频程的频带数。

> 例如，假设 $B=1$，则 $f_k = f_1 2^{k-1}$ ，取 $f_s=8000Hz, f_1 = 500Hz$，则 $f_2=1000Hz, f_3=2000Hz, f_4=4000Hz, f_5=8000Hz$，不能再大了。而在DFT中，这几个频率呈线性变化。

则 Q 因子计算如下：
$$Q=\frac{f_k}{f_{k+1}-f_k}=\left(2^{1 / B}-1\right)^{-1}$$
同时窗函数长度 $N_k$ 满足：
$$N_k=\frac{f_s}{f_k} Q$$
## CQCC 提取
首先 MFCC 计算如下：
$$\operatorname{MFCC}(q)=\sum_{m=1}^M \log [M F(m)] \cos \left[\frac{q\left(m-\frac{1}{2}\right) \pi}{M}\right]$$
其中，Mel 谱计算如下：
$$M F(m)=\sum_{k=1}^K\left|X^{D F T}(k)\right|^2 H_m(k)$$
其中，$k$ 是DFT之后的频率索引系数，$H_m(k)$ 是第 $m$ 个Mel 尺度下的三角加权函数带通滤波器。这里，$M$ 代表滤波器的个数（$M F(m)$ 为 $M$ 点的序列），$q$ 代表离散余弦变换的点数。

倒谱分析不能直接被用于 CQT，因为 $X^{C Q}(k)$ 和 DCT 的余弦函数的尺度不同（一个是几何一个是线性）。可以通过将几何空间转换为线性空间来解决这个问题。

由于在 $X^{C Q}(k)$ 中，$k$ 个频带几何分布，信号重构的过程可以看成是前 $k$ 个频带（低频部分）进行下采样，后 $K-k$ 个频带（高频部分）进行上采样得到的，将第 $k$ 个频带的中心频率 $f_k$ 和 第一个频带的中心频率 $f_1=f_{min}$ 的频率差记为：
$$\Delta f^{k \leftrightarrow 1}=f_k-f_1=f_1\left(2^{\frac{k-1}{B}}-1\right)$$
其中，$k = 1,2,\cdots, K$ 为频率索引，距离 $\Delta f^{k \leftrightarrow 1}$ 为 $k$ 的递增函数。我们以周期 $T_l$ 进行重采样，这等效于确定一个关于 $k_l$ 的函数使得：
$$T_l=\Delta f^{k_l \leftrightarrow 1}$$
以下关注第一个倍频程，通过将第一个倍频程以周期 $T_l$ 进行 $d$ 等分，解得 $k_l$ 为：
$$\frac{f_1}{d}=f_1\left(2^{\frac{k_l-1}{B}}-1\right) \rightarrow k_l=B \log _2\left(1+\frac{1}{d}\right)$$
新的频率计算为：
$$F_l=\frac{1}{T_l}=\left[f_1\left(2^{\frac{k_l-1}{B}}-1\right)\right]^{-1}$$
因此，在第一个倍频程中有 $d$ 个均匀采样，第二个倍频程中有 $2d$ 个，第 $j-1$ 个倍频程中有 $2^jd$ 个。

信号重构方法采用了多相抗混叠滤波器和样条插值方法，以均匀的采样率 $F_l$ 对信号进行重新采样。

最后，CQCC 系数计算如下：
$$C Q C C(p)=\sum_{l=1}^L \log \left|X^{C Q}(l)\right|^2 \cos \left[\frac{p\left(l-\frac{1}{2}\right) \pi}{L}\right]$$
其中，$p=0,1,\cdots,L-1$ 是重采样之后得频带索引。

> 我理解是，比如说设置 $d=5$ ，频率 $500-1000Hz$ 之间采样就可以分成五个 $500,600,700,800,900$，而频率 $1000-2000Hz$ 之间采样分成 $2d=10$ 个频带，即 $1000,1100,1200,\cdots,1900$，同理频率范围在 $2000-4000Hz$ 之间的频率可以分成 $2^2*5=20$ 个频带，以此类推。这样虽然两两中心频率之间是几何间隔，但是采样的数量也是呈几何增长，所以最终重采样得到的频率还是线性的，从而可以进行 DCT 变换。

## 实验设置及结果（略）